import{r as Le,a as L,b as At,o as b,c as k,d as E,e as g,w as C,F as q,f as _e,u as le,g as re,n as ge,t as Qe,h as Q,i as Ot,j as Je,k as kt,l as Tt,m as St,p as Lt,q as jt,s as Dt,v as Rt}from"./element-plus-3ac01532.js";import{R as Nt,P as It,E as zt,V as y,M as J,T as ee,Q as Me,S as Ae,a as j,b as Ft,c as Yt,B as Ht,d as Ut,F as et,C as Vt,e as Kt,f as Zt,A as Xt,D as Wt,g as $t,h as Bt,i as Gt,j as qt,k as tt,W as Qt,l as Jt,m as en}from"./three-9b8143d9.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&e(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const nt={type:"change"},Oe={type:"start"},ot={type:"end"},ye=new Nt,st=new It,tn=Math.cos(70*Ft.DEG2RAD);class nn extends zt{constructor(n,r){super(),this.object=n,this.domElement=r,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new y,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:J.ROTATE,MIDDLE:J.DOLLY,RIGHT:J.PAN},this.touches={ONE:ee.ROTATE,TWO:ee.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Pe),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(nt),e.update(),s=o.NONE},this.setZoom=function(t){h=t},this.update=function(){const t=new y,a=new Me().setFromUnitVectors(n.up,new y(0,1,0)),f=a.clone().invert(),_=new y,M=new Me,N=new y,D=2*Math.PI;return function(Mt=null){const qe=e.object.position;t.copy(qe).sub(e.target),t.applyQuaternion(a),c.setFromVector3(t),e.autoRotate&&s===o.NONE&&oe(ct(Mt)),e.enableDamping?(c.theta+=l.theta*e.dampingFactor,c.phi+=l.phi*e.dampingFactor,w.add(t.copy(x).multiplyScalar(e.dampingFactor))):(c.theta+=l.theta,c.phi+=l.phi,w.add(x));let I=e.minAzimuthAngle,z=e.maxAzimuthAngle;isFinite(I)&&isFinite(z)&&(I<-Math.PI?I+=D:I>Math.PI&&(I-=D),z<-Math.PI?z+=D:z>Math.PI&&(z-=D),I<=z?c.theta=Math.max(I,Math.min(z,c.theta)):c.theta=c.theta>(I+z)/2?Math.max(I,c.theta):Math.min(z,c.theta)),c.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,c.phi)),c.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(m,e.dampingFactor):e.target.add(m),e.zoomToCursor&&de||e.object.isOrthographicCamera?c.radius=Ee(c.radius):c.radius=Ee(c.radius*h),t.setFromSpherical(c),t.applyQuaternion(f),qe.copy(e.target).add(t),e.object.lookAt(e.target),e.enableDamping===!0?(l.theta*=1-e.dampingFactor,l.phi*=1-e.dampingFactor,m.multiplyScalar(1-e.dampingFactor),x.multiplyScalar(1-e.dampingFactor)):(l.set(0,0,0),m.set(0,0,0),x.set(0,0,0)),e.object.up.copy(w).normalize();let fe=!1;if(e.zoomToCursor&&de){let ae=null;if(e.object.isPerspectiveCamera){const ie=t.length();ae=Ee(ie*h);const me=ie-ae;e.object.position.addScaledVector(De,me),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const ie=new y(U.x,U.y,0);ie.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0;const me=new y(U.x,U.y,0);me.unproject(e.object),e.object.position.sub(me).add(ie),e.object.updateMatrixWorld(),ae=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ae!==null&&(this.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ae).add(e.object.position):(ye.origin.copy(e.object.position),ye.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(ye.direction))<tn?n.lookAt(e.target):(st.setFromNormalAndCoplanarPoint(e.object.up,e.target),ye.intersectPlane(st,e.target))))}else e.object.isOrthographicCamera&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/h)),e.object.updateProjectionMatrix(),fe=!0);return h=1,de=!1,fe||_.distanceToSquared(e.object.position)>d||8*(1-M.dot(e.object.quaternion))>d||N.distanceToSquared(e.target)>0?(e.dispatchEvent(nt),_.copy(e.object.position),M.copy(e.object.quaternion),N.copy(e.target),fe=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Be),e.domElement.removeEventListener("pointerdown",We),e.domElement.removeEventListener("pointercancel",se),e.domElement.removeEventListener("wheel",$e),e.domElement.removeEventListener("pointermove",xe),e.domElement.removeEventListener("pointerup",se),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",Pe),e._domElementKeyEvents=null)};const e=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const d=1e-6,c=new Ae,l=new Ae;let h=1;const m=new y,w=n.up.clone(),x=new y,A=new j,T=new j,P=new j,p=new j,R=new j,O=new j,$=new j,B=new j,ne=new j,De=new y,U=new j;let de=!1;const u=[],ue={};this.simulate=function(){const t=new Me().setFromUnitVectors(n.up,new y(0,1,0)),a=new y,f=new Ae,_=new y;return(M,N,D)=>{a.copy(M).sub(N).applyQuaternion(t),f.setFromVector3(a),l.theta=f.theta-c.theta,l.phi=f.phi-c.phi,m.copy(N).sub(e.target),l.theta<-3.14159?l.theta+=6.28318:l.theta>3.14159&&(l.theta-=6.28318),l.phi<-3.14159?l.phi+=6.28318:l.phi>3.14159&&(l.phi-=6.28318),x.copy(D).sub(_.copy(w).normalize())}}();function ct(t){return t!==null?2*Math.PI/60*e.autoRotateSpeed*t:2*Math.PI/60/60*e.autoRotateSpeed}function pe(){return Math.pow(.95,e.zoomSpeed)}function oe(t){l.theta-=t}function he(t){l.phi-=t}const Re=function(){const t=new y;return function(f,_){t.setFromMatrixColumn(_,0),t.multiplyScalar(-f),m.add(t)}}(),Ne=function(){const t=new y;return function(f,_){e.screenSpacePanning===!0?t.setFromMatrixColumn(_,1):(t.setFromMatrixColumn(_,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(f),m.add(t)}}(),G=function(){const t=new y;return function(f,_){const M=e.domElement;if(e.object.isPerspectiveCamera){const N=e.object.position;t.copy(N).sub(e.target);let D=t.length();D*=Math.tan(e.object.fov/2*Math.PI/180),Re(2*f*D/M.clientHeight,e.object.matrix),Ne(2*_*D/M.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(Re(f*(e.object.right-e.object.left)/e.object.zoom/M.clientWidth,e.object.matrix),Ne(_*(e.object.top-e.object.bottom)/e.object.zoom/M.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function ve(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?h/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Ie(t){e.object.isPerspectiveCamera||e.object.isOrthographicCamera?h*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ze(t){if(!e.zoomToCursor)return;de=!0;const a=e.domElement.getBoundingClientRect(),f=t.clientX-a.left,_=t.clientY-a.top,M=a.width,N=a.height;U.x=f/M*2-1,U.y=-(_/N)*2+1,De.set(U.x,U.y,1).unproject(e.object).sub(e.object.position).normalize()}function Ee(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function Fe(t){A.set(t.clientX,t.clientY)}function dt(t){ze(t),$.set(t.clientX,t.clientY)}function Ye(t){p.set(t.clientX,t.clientY)}function ut(t){T.set(t.clientX,t.clientY),P.subVectors(T,A).multiplyScalar(e.rotateSpeed);const a=e.domElement;oe(2*Math.PI*P.x/a.clientHeight),he(2*Math.PI*P.y/a.clientHeight),A.copy(T),e.update()}function pt(t){B.set(t.clientX,t.clientY),ne.subVectors(B,$),ne.y>0?ve(pe()):ne.y<0&&Ie(pe()),$.copy(B),e.update()}function ht(t){R.set(t.clientX,t.clientY),O.subVectors(R,p).multiplyScalar(e.panSpeed),G(O.x,O.y),p.copy(R),e.update()}function ft(t){ze(t),t.deltaY<0?Ie(pe()):t.deltaY>0&&ve(pe()),e.update()}function mt(t){let a=!1;switch(t.code){case e.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?he(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):G(0,e.keyPanSpeed),a=!0;break;case e.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?he(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):G(0,-e.keyPanSpeed),a=!0;break;case e.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?oe(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):G(e.keyPanSpeed,0),a=!0;break;case e.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?oe(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):G(-e.keyPanSpeed,0),a=!0;break}a&&(t.preventDefault(),e.update())}function He(){if(u.length===1)A.set(u[0].pageX,u[0].pageY);else{const t=.5*(u[0].pageX+u[1].pageX),a=.5*(u[0].pageY+u[1].pageY);A.set(t,a)}}function Ue(){if(u.length===1)p.set(u[0].pageX,u[0].pageY);else{const t=.5*(u[0].pageX+u[1].pageX),a=.5*(u[0].pageY+u[1].pageY);p.set(t,a)}}function Ve(){const t=u[0].pageX-u[1].pageX,a=u[0].pageY-u[1].pageY,f=Math.sqrt(t*t+a*a);$.set(0,f)}function _t(){e.enableZoom&&Ve(),e.enablePan&&Ue()}function gt(){e.enableZoom&&Ve(),e.enableRotate&&He()}function Ke(t){if(u.length==1)T.set(t.pageX,t.pageY);else{const f=Ce(t),_=.5*(t.pageX+f.x),M=.5*(t.pageY+f.y);T.set(_,M)}P.subVectors(T,A).multiplyScalar(e.rotateSpeed);const a=e.domElement;oe(2*Math.PI*P.x/a.clientHeight),he(2*Math.PI*P.y/a.clientHeight),A.copy(T)}function Ze(t){if(u.length===1)R.set(t.pageX,t.pageY);else{const a=Ce(t),f=.5*(t.pageX+a.x),_=.5*(t.pageY+a.y);R.set(f,_)}O.subVectors(R,p).multiplyScalar(e.panSpeed),G(O.x,O.y),p.copy(R)}function Xe(t){const a=Ce(t),f=t.pageX-a.x,_=t.pageY-a.y,M=Math.sqrt(f*f+_*_);B.set(0,M),ne.set(0,Math.pow(B.y/$.y,e.zoomSpeed)),ve(ne.y),$.copy(B)}function yt(t){e.enableZoom&&Xe(t),e.enablePan&&Ze(t)}function bt(t){e.enableZoom&&Xe(t),e.enableRotate&&Ke(t)}function We(t){e.enabled!==!1&&(u.length===0&&(e.domElement.setPointerCapture(t.pointerId),e.domElement.addEventListener("pointermove",xe),e.domElement.addEventListener("pointerup",se)),Pt(t),t.pointerType==="touch"?Et(t):wt(t))}function xe(t){e.enabled!==!1&&(t.pointerType==="touch"?xt(t):vt(t))}function se(t){Ct(t),u.length===0&&(e.domElement.releasePointerCapture(t.pointerId),e.domElement.removeEventListener("pointermove",xe),e.domElement.removeEventListener("pointerup",se)),e.dispatchEvent(ot),s=o.NONE}function wt(t){let a;switch(t.button){case 0:a=e.mouseButtons.LEFT;break;case 1:a=e.mouseButtons.MIDDLE;break;case 2:a=e.mouseButtons.RIGHT;break;default:a=-1}switch(a){case J.DOLLY:if(e.enableZoom===!1)return;dt(t),s=o.DOLLY;break;case J.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;Ye(t),s=o.PAN}else{if(e.enableRotate===!1)return;Fe(t),s=o.ROTATE}break;case J.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;Fe(t),s=o.ROTATE}else{if(e.enablePan===!1)return;Ye(t),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Oe)}function vt(t){switch(s){case o.ROTATE:if(e.enableRotate===!1)return;ut(t);break;case o.DOLLY:if(e.enableZoom===!1)return;pt(t);break;case o.PAN:if(e.enablePan===!1)return;ht(t);break}}function $e(t){e.enabled===!1||e.enableZoom===!1||s!==o.NONE||(t.preventDefault(),e.dispatchEvent(Oe),ft(t),e.dispatchEvent(ot))}function Pe(t){e.enabled===!1||e.enablePan===!1||mt(t)}function Et(t){switch(Ge(t),u.length){case 1:switch(e.touches.ONE){case ee.ROTATE:if(e.enableRotate===!1)return;He(),s=o.TOUCH_ROTATE;break;case ee.PAN:if(e.enablePan===!1)return;Ue(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(e.touches.TWO){case ee.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;_t(),s=o.TOUCH_DOLLY_PAN;break;case ee.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;gt(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&e.dispatchEvent(Oe)}function xt(t){switch(Ge(t),s){case o.TOUCH_ROTATE:if(e.enableRotate===!1)return;Ke(t),e.update();break;case o.TOUCH_PAN:if(e.enablePan===!1)return;Ze(t),e.update();break;case o.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;yt(t),e.update();break;case o.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;bt(t),e.update();break;default:s=o.NONE}}function Be(t){e.enabled!==!1&&t.preventDefault()}function Pt(t){u.push(t)}function Ct(t){delete ue[t.pointerId];for(let a=0;a<u.length;a++)if(u[a].pointerId==t.pointerId){u.splice(a,1);return}}function Ge(t){let a=ue[t.pointerId];a===void 0&&(a=new j,ue[t.pointerId]=a),a.set(t.pageX,t.pageY)}function Ce(t){const a=t.pointerId===u[0].pointerId?u[1]:u[0];return ue[a.pointerId]}e.domElement.addEventListener("contextmenu",Be),e.domElement.addEventListener("pointerdown",We),e.domElement.addEventListener("pointercancel",se),e.domElement.addEventListener("wheel",$e,{passive:!1}),this.update()}}const ce=new y,te=new Vt,on=5812956,sn=15752732,an=16555853,ln=15305514,rn=16761864;class cn extends Yt{constructor(n,r){const e=new Ht,o=new Ut,s=[],d=[],c=[],l={};h("n2","n1","n3"),h("n4","n2","n3"),h("n2","o","n1"),h("n4","o","n2"),h("n3","o","n4"),h("n1","o","n3");function h(w,x,A){c.push(m(w),m(x),m(A))}function m(w){l[w]===void 0&&(l[w]=[]);const x=s.length/3;return l[w].push(x),s.push(0,0,0),d.push(0,0,1),x}e.setAttribute("position",new et(s,3)),e.setAttribute("normal",new et(d,3)),e.setIndex(c),super(e,o),this.type="CameraHelper",this.camera=n,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=l,this.target=new y,this.faces=c,this.viewId=r,this.selectStatus={ref_selecting:!1,ref_selected:!1,src_selecting:!1,src_selected:!1},this.updateColor(),this.update()}updateColor(){this.selectStatus.ref_selecting?this.material.color.set(on):this.selectStatus.ref_selected?this.material.color.set(sn):this.selectStatus.src_selected?this.material.color.set(ln):this.selectStatus.src_selecting?this.material.color.set(an):this.material.color.set(rn)}update(){const n=this.geometry,r=this.pointMap,e=1,o=1;te.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=[];r.o.forEach(l=>s[l]=new y),be("n1",s,r,n,te,-e,-o,-1),be("n2",s,r,n,te,e,-o,-1),be("n3",s,r,n,te,-e,o,-1),be("n4",s,r,n,te,e,o,-1),this.target.set(0,0,-1).unproject(te).normalize().multiplyScalar(.15);const d=new y,c=new y;for(let l=0;l<this.faces.length;l+=3)d.copy(s[this.faces[l+1]]).sub(s[this.faces[l]]),c.copy(s[this.faces[l+2]]).sub(s[this.faces[l]]),d.cross(c).normalize(),n.getAttribute("normal").setXYZ(this.faces[l],d.x,d.y,d.z),n.getAttribute("normal").setXYZ(this.faces[l+1],d.x,d.y,d.z),n.getAttribute("normal").setXYZ(this.faces[l+2],d.x,d.y,d.z);n.getAttribute("position").needsUpdate=!0,n.getAttribute("normal").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function be(i,n,r,e,o,s,d,c){ce.set(s,d,c).unproject(o);const l=r[i];if(l!==void 0){const h=e.getAttribute("position");l.forEach(m=>{h.setXYZ(m,ce.x,ce.y,ce.z),n[m]=ce.clone()})}}const dn={class:"no-select flex items-center justify-center h-screen"},un={class:"flex items-center justify-center h-full flex-1",ref:"container"},pn={ref:"rem_calc",class:"flex flex-col items-center justify-start w-xl"},hn={key:0,class:"m-4"},fn={key:1},mn={class:"pos-relative"},_n={class:"pos-absolute of-hidden top-0 w-full h-72"},gn=["onMouseenter"],yn={class:"flex items-center justify-evenly w-full"},bn=E("a",{class:"text-base"},"Feature Matching",-1),wn={key:0,class:"m-6"},vn={key:1,class:"mt-6"},En={class:"pos-relative"},xn={key:0,class:"pos-absolute of-hidden top-0",style:{width:"15rem",height:"8.44rem"}},Pn=["onMouseenter"],Cn={class:"h-8 line-height-8 w-full text-center text-base"},Mn=E("a",{class:"text-base"},"Rendering Config",-1),An={class:"flex mt-3 h-8 items-center justify-center"},On=E("div",{class:"text-sm w-32"},"Point Cloud Size",-1),kn={class:"flex h-8 items-center justify-center"},Tn=E("div",{class:"text-sm w-32"},"Camera Size",-1),Sn={class:"flex h-8 items-center justify-center"},Ln=E("div",{class:"text-sm w-32"},"Camera Visibility",-1);let at=null,v=[],S=[],F=null,V=null,K=null,Y=null;const it=new Kt,Z=new j(-2,-2);let X=-1,W=-1,H=[];const Te=Le(.012),we=Le(2),Se=Le(!0),rt=[],ke=(i,n)=>{window.addEventListener(i,n),rt.push({eventName:i,fn:n})},jn=()=>rt.forEach(i=>window.removeEventListener(i.eventName,i.fn)),Dn={name:"App",props:{path:{type:String,default:"colmap.json"}},data(){return{loaded:!1,preview_name:"",preview_registered:!1,prev_select_disabled:!1,next_select_disabled:!1,play_select_interval:0,src_view_idx:0,src_view_data:null,ref_kps:[],src_kps:[],active_kp_idx:-1}},methods:{init(i){S=i,V=new Zt,V.add(new Xt(1));const n=new Wt(16777215,2);n.position.set(0,0,1),V.add(n),V.add(new $t(16777215,.8)),new Bt().load("pcd.ply",e=>V.add(at=new Gt(e,new qt({size:Te.value,vertexColors:!0})))),K=new tt(45,this.$refs.container.clientWidth/this.$refs.container.clientHeight,.01,10),K.up.set(0,0,1),K.position.z=.2;const r=new tt(60,1.2,.01*we.value,.1*we.value);r.up.set(0,0,1),F=new Qt({antialias:!1}),F.setSize(this.$refs.container.clientWidth,this.$refs.container.clientHeight),this.$refs.container.appendChild(F.domElement),F.setClearColor(16777215),Y=new nn(K,F.domElement),Y.enableDamping=!0,Y.enableZoom=!0,Y.enablePan=!0,Y.setZoom(3),S.forEach((e,o)=>{if(e.c2w.length==16){const s=r.clone(),d=new Jt().fromArray(e.c2w);s.applyMatrix4(d),s.updateMatrixWorld(!0);const c=new cn(s,o);V.add(c),v.push(c)}else v.push(null)}),this.loaded=!0,this.select_view(0,-1)},animate(){if(Se.value&&Z.x>-1&&Z.x<1&&Z.y>-1&&Z.y<1){it.setFromCamera(Z,K);const i=it.intersectObjects(V.children);let n=-1;for(let r=0;r<i.length;++r)if(i[r].object.type=="CameraHelper"){n=i[r].object.viewId;break}n!==X&&(n>=0&&(v[n].selectStatus.ref_selecting=!0,v[n].updateColor()),X>=0&&(v[X].selectStatus.ref_selecting=!1,v[X].updateColor()),X=n)}Y.update(),F.render(V,K),requestAnimationFrame(this.animate)},pcd_size_onchange(i){at.material.size=i},camera_size_onchange(i){v.forEach(n=>{n&&(n.camera.near=i*.01,n.camera.far=i*.1,n.camera.updateProjectionMatrix(),n.geometry.computeBoundingSphere(),n.update())})},camera_visibility_onchange(i){v.forEach(n=>{n&&(n.visible=i)})},select_view(i,n){if(W=i,n>=0&&v[n]&&(v[n].selectStatus.ref_selected=!1,v[n].updateColor()),v[i]){v[i].selectStatus.ref_selected=!0,v[i].updateColor();const r=v[i];Y.simulate(r.camera.position,r.target.clone().applyMatrix4(r.camera.matrixWorld),r.camera.up)}H.forEach(r=>{r&&(r.selectStatus.src_selecting=!1,r.selectStatus.src_selected=!1,r.updateColor())}),H=S[i].matches.map(r=>v[r.idx]),H.forEach(r=>{r&&(r.selectStatus.src_selecting=!0,r.updateColor())}),this.preview_name=S[i].name,this.preview_registered=v[i],this.prev_select_disabled=i==0,this.next_select_disabled=i+1==S.length,this.next_select_disabled&&(this.play_select_interval=0),i!==n&&(this.src_view_data=null,this.ref_kps=[],this.src_kps=[])},select_src_view(i,n){this.src_view_idx=i,n>=0&&H[n]&&(H[n].selectStatus.src_selected=!1,H[n].updateColor()),H[i]&&(H[i].selectStatus.src_selected=!0,H[i].updateColor());const r=S[W].width*9/(16*S[W].height),e=S[W].matches[i],o=[],s=[],d=r>1?.5-.5/r:0,c=r<1?.5-.5*r:0;for(let l=0;l<e.ref_x.length;++l){const h=(e.ref_x[l]*.01-d)/(1-2*d),m=(e.ref_y[l]*.01-c)/(1-2*c);if(0<h&&h<1&&0<m&&m<1){const w=S[e.idx].width*9/(16*S[e.idx].height),x=w>1?.5-.5/w:0,A=w<1?.5-.5*w:0,T=(e.src_x[l]*.01-x)/(1-2*x),P=(e.src_y[l]*.01-A)/(1-2*A);0<T&&T<1&&0<P&&P<1&&(o.push({x:(h*32).toFixed(2)+"rem",y:(m*18).toFixed(2)+"rem",valid:e.valid[l],idx:l}),s.push({x:(T*15).toFixed(2)+"rem",y:(P*8.44).toFixed(2)+"rem",valid:e.valid[l],idx:l}))}}this.ref_kps=o,this.src_kps=s},prev_select(){this.$refs.carousel.setActiveItem(W-1),this.play_select_interval=0},next_select(){this.$refs.carousel.setActiveItem(W+1),this.play_select_interval=0},play_select(){this.play_select_interval=500-this.play_select_interval},reset_select(){this.$refs.carousel.setActiveItem(0),this.play_select_interval=0},load_matches(){this.src_view_data=S[W].matches.map(i=>S[i.idx]),this.select_src_view(0,-1)},calc_rem(i){return i*this.$refs.rem_calc.clientWidth/36}},mounted(){new en().load(this.path,i=>{this.init(JSON.parse(i)),ke("resize",n=>{K.aspect=this.$refs.container.clientWidth/this.$refs.container.clientHeight,K.updateProjectionMatrix(),F.setSize(this.$refs.container.clientWidth,this.$refs.container.clientHeight)}),ke("pointermove",n=>{Z.x=(n.clientX-this.$refs.container.clientLeft)/this.$refs.container.clientWidth*2-1,Z.y=(n.clientY-this.$refs.container.clientTop)/this.$refs.container.clientHeight*-2+1}),ke("click",n=>{X>=0&&this.$refs.carousel.setActiveItem(X)}),this.animate()})},unmounted(){Y&&Y.dispose(),F&&F.dispose(),jn()}},Rn=Object.assign(Dn,{setup(i){return(n,r)=>{const e=L("el-skeleton"),o=L("el-image"),s=L("el-carousel-item"),d=L("el-carousel"),c=L("el-button"),l=L("el-card"),h=L("el-empty"),m=L("el-collapse-item"),w=L("el-collapse"),x=L("el-slider"),A=L("el-switch"),T=L("el-scrollbar"),P=At("btn");return b(),k("div",dn,[E("div",un,null,512),g(T,null,{default:C(()=>[E("div",pn,[g(l,{"body-style":"padding: 0px",class:"w-lg my-6"},{default:C(()=>[n.loaded?(b(),k("div",fn,[E("div",mn,[g(d,{autoplay:n.play_select_interval>0,interval:n.play_select_interval,ref:"carousel",loop:!1,"indicator-position":"none",arrow:"never",height:"18rem",onChange:n.select_view},{default:C(()=>[(b(!0),k(q,null,_e(le(S),p=>(b(),Q(s,{key:p},{default:C(()=>[g(o,{src:p.image,class:"w-full h-72",style:{display:"block"},fit:"cover"},null,8,["src"])]),_:2},1024))),128))]),_:1},8,["autoplay","interval","onChange"]),E("div",_n,[(b(!0),k(q,null,_e(n.ref_kps,p=>(b(),k("div",{key:p,class:ge((p.idx==n.active_kp_idx?"bg-green":p.valid?"bg-blue":"bg-red")+" pos-absolute b-rd-50% w-2 h-2"),style:Je({top:p.y,left:p.x,transform:"translate(-50%, -50%)"+(p.idx==n.active_kp_idx?"scale(1.5, 1.5)":"")}),onMouseenter:()=>n.active_kp_idx=p.idx,onMouseleave:r[0]||(r[0]=()=>n.active_kp_idx=-1)},null,46,gn))),128))])]),E("div",yn,[re(g(c,{onClick:n.reset_select,style:{"border-radius":"0",height:"2.5rem","font-size":"1.2rem",margin:"0px"},class:"flex-1",text:"",circle:"",icon:le(kt)},null,8,["onClick","icon"]),[[P]]),re(g(c,{bg:n.play_select_interval>0,onClick:n.play_select,style:{"border-radius":"0",height:"2.5rem","font-size":"1.2rem",margin:"0px"},class:"flex-1",text:"",circle:"",icon:le(Tt)},null,8,["bg","onClick","icon"]),[[P]]),E("a",{class:ge(n.preview_registered?"px-4 h-10 line-height-10":"text-red-800 px-4 h-10 line-height-10")},Qe(n.preview_name),3),re(g(c,{disabled:n.prev_select_disabled,onClick:n.prev_select,style:{"border-radius":"0",height:"2.5rem","font-size":"1rem",margin:"0px"},class:"flex-1",text:"",circle:"",icon:le(St)},null,8,["disabled","onClick","icon"]),[[P]]),re(g(c,{disabled:n.next_select_disabled,onClick:n.next_select,style:{"border-radius":"0",height:"2.5rem","font-size":"1rem",margin:"0px"},class:"flex-1",text:"",circle:"",icon:le(Lt)},null,8,["disabled","onClick","icon"]),[[P]])])])):(b(),k("div",hn,[g(e,{rows:8,animated:""})]))]),_:1}),g(l,{"body-style":"padding-top:0px;padding-bottom:0px;padding-left:1rem;padding-right:1rem",class:"w-lg mb-6"},{default:C(()=>[g(w,{style:{border:"none"},"model-value":["1"]},{default:C(()=>[g(m,{name:"1"},{title:C(()=>[bn]),default:C(()=>[n.loaded?(b(),k("div",vn,[n.src_view_data===null?(b(),Q(h,{key:0,description:"Reference View Changed",style:{padding:"0px",height:"14rem"},"image-size":n.calc_rem(6)},{default:C(()=>[re((b(),Q(c,{type:"primary",onClick:n.load_matches},{default:C(()=>[Ot("Reload")]),_:1},8,["onClick"])),[[P]])]),_:1},8,["image-size"])):n.src_view_data.length===0?(b(),Q(h,{key:1,description:"No Valid Matches",style:{padding:"0px",height:"14rem"},"image-size":n.calc_rem(10)},null,8,["image-size"])):(b(),k(q,{key:2},[g(d,{autoplay:!1,"indicator-position":"none",loop:!1,arrow:"never",height:"12rem",type:"card",onChange:n.select_src_view},{default:C(()=>[(b(!0),k(q,null,_e(n.src_view_data,(p,R)=>(b(),Q(s,{key:p},{default:C(()=>[E("div",En,[g(o,{src:p.image,style:{display:"block",width:"15rem",height:"8.44rem"},fit:"cover"},null,8,["src"]),R===n.src_view_idx?(b(),k("div",xn,[(b(!0),k(q,null,_e(n.src_kps,O=>(b(),k("div",{key:O,class:ge((O.idx==n.active_kp_idx?"bg-green":O.valid?"bg-blue":"bg-red")+" pos-absolute b-rd-50% w-2 h-2"),style:Je({top:O.y,left:O.x,transform:"translate(-50%, -50%)"+(O.idx==n.active_kp_idx?"scale(1.5, 1.5)":"")}),onMouseenter:()=>n.active_kp_idx=O.idx,onMouseleave:r[1]||(r[1]=()=>n.active_kp_idx=-1)},null,46,Pn))),128))])):jt("",!0)])]),_:2},1024))),128))]),_:1},8,["onChange"]),E("div",Cn,[E("a",{class:ge(n.src_view_data[n.src_view_idx].c2w.length===16?"":"text-red-800")},Qe(`[${n.src_view_idx+1}/${n.src_view_data.length}] - ${n.src_view_data[n.src_view_idx].name}`),3)])],64))])):(b(),k("div",wn,[g(e,{rows:5,animated:""})]))]),_:1})]),_:1})]),_:1}),g(l,{"body-style":"padding-top:0px;padding-bottom:0px",class:"w-lg mb-6"},{default:C(()=>[g(w,{style:{border:"none"},"model-value":["1"]},{default:C(()=>[g(m,{name:"1"},{title:C(()=>[Mn]),default:C(()=>[n.loaded?(b(),k(q,{key:1},[E("div",An,[On,g(x,{class:"flex-1",modelValue:Te.value,"onUpdate:modelValue":r[2]||(r[2]=p=>Te.value=p),min:.002,max:.02,step:.002,"format-tooltip":p=>p*500,onInput:n.pcd_size_onchange},null,8,["modelValue","format-tooltip","onInput"])]),E("div",kn,[Tn,g(x,{class:"flex-1",modelValue:we.value,"onUpdate:modelValue":r[3]||(r[3]=p=>we.value=p),min:1,max:5,step:1,onInput:n.camera_size_onchange},null,8,["modelValue","onInput"])]),E("div",Sn,[Ln,g(A,{class:"flex-1",modelValue:Se.value,"onUpdate:modelValue":r[4]||(r[4]=p=>Se.value=p),onInput:n.camera_visibility_onchange},null,8,["modelValue","onInput"])])],64)):(b(),Q(e,{key:0,class:"mt-3",rows:2,animated:""}))]),_:1})]),_:1})]),_:1})],512)]),_:1})])}}});const je=Dt(Rn),lt=function(i){let n=i.target;n.nodeName=="SPAN"&&(n=i.target.parentNode),n.blur()};je.directive("btn",{mounted(i){i.addEventListener("focus",lt)},unmounted(i){i.removeEventListener("focus",lt)}});je.use(Rt);je.mount("#app");
